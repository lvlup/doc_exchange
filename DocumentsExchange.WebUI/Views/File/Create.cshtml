@model DocumentsExchange.DataLayer.Entity.File

<div class="">
    <h3>Добавление файла:</h3>

    @using (Html.BeginForm("Create","File", null, FormMethod.Post, new { enctype = "multipart/form-data", id= "AddFileForm" }))
    {
        @Html.AntiForgeryToken()
        <div class="form-horizontal">
            @Html.ValidationSummary(true)
            <div class="form-group">
                <label class="col-sm-2 control-label">Название:</label>
                <div class="col-sm-10">
                    @Html.TextBoxFor(p => p.FileName, new {@class = "form-control", tabindex = 1})
                    @Html.ValidationMessageFor(model => model.FileName, null, new {@class = "text-danger"})
                </div>
            </div>

            @Html.HiddenFor(model => model.OranizationId)
            @Html.HiddenFor(model => model.CategoryId)

            <div class="form-group">
                <div class="col-sm-10">
                    <input type="file" name="upload" id="uploadFile"/>
                </div>
                @*<label class="col-sm-10 btn btn-default btn-file">
                    Browse <input type="file" name="upload" class="hidden">
                </label>*@
            </div>

            <div class="form-group">
                <div class="col-sm-offset-2 col-sm-10">
                    <button type="submit" class="btn btn-default" id="addFileBtn">Добавить файл</button>
                </div>
            </div>
        </div>

    }
</div>

<script>
    $(function() {
        $("#addFileBtn").click(function (e) {
            var dataArray = $(this).closest("form").serializeArray();
            var act = '@Url.Action("Create","File")';
            e.preventDefault();


            var files = $('#uploadFile')[0].files;
            if (files.length > 0)
            {
                    var data = new FormData();
                    for (var x = 0; x < files.length; x++) {
                        data.append("file" + x, files[x]);
                    }

                    //for (var i = 0; i< dataArray.length; i++) {
                    //    data.append(dataArray[i].name, dataArray[i].value);
                    //}
                    dataArray.forEach(function (item) {
                    data.append(item.name, item.value);
                });
                //    $.post(act, data).done(function (data) {
                //        $("#FilesTable").html(data);
                //});

                    $.ajax({
                        type: "POST",
                        url: act,
                        contentType: false,
                        processData: false,
                        data: data,
                        success: function (data) {
                            $("#FilesTable").html(data);
                        },
                        error: function (xhr, status, p3) {
                            alert(xhr.responseText);
                        }
                    });
            }
        });
    })
</script>


   

